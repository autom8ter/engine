# Engine

`go get github.com/autom8ter/engine`

## API/Interface/Driver
/driver/driver.go
```go
package driver

import (
	"context"
	"github.com/grpc-ecosystem/grpc-gateway/runtime"
	"google.golang.org/grpc"
	"net"
)

// Handler is an interface for representing gRPC server implementations.
type Plugin interface {
	RegisterWithServer(*grpc.Server)
	RegisterWithHandler(context.Context, *runtime.ServeMux, *grpc.ClientConn) error
}

// Server provides an interface for starting and stopping the server.
type Listener interface {
	Serve(l net.Listener) error
	Shutdown()
}

```

## Example Grpc Implementation

/testing/helloworld/hello.go
```go
package helloworld

import (
	"context"
	"fmt"
	"github.com/grpc-ecosystem/grpc-gateway/runtime"
	"google.golang.org/grpc"
	"strings"
)

type GreeterFunc func(ctx context.Context, req *HelloRequest) (*HelloReply, error)

type Greeter struct {
	Func GreeterFunc
}

func NewGreeter(fn GreeterFunc) *Greeter {
	return &Greeter{
		fn,
	}
}

func NewBasicGreeter() *Greeter {
	return &Greeter{
		Func: func(ctx context.Context, req *HelloRequest) (reply *HelloReply, e error) {
			reply.Message = fmt.Sprintf("Hello %s!", strings.ToTitle(req.Name))
			return
		},
	}
}

func (g *Greeter) SayHello(ctx context.Context, req *HelloRequest) (*HelloReply, error) {
	return g.Func(ctx, req)
}

func (g *Greeter) RegisterWithServer(s *grpc.Server) {
	RegisterGreeterServer(s, g)
}

func (g *Greeter) RegisterWithHandler(ctx context.Context, m *runtime.ServeMux, cc *grpc.ClientConn) error {
	return RegisterGreeterHandler(ctx, m, cc)
}


```

## Example Engine
./engine_test.go

engine starts a REST reverse proxy server in front of a gRPC server that serves an easily satisfiable api interface thats
basically completely autogenerated by protocgen-go and protocgen-grpc-gateway

```go
package engine_test

import (
	"github.com/autom8ter/engine"
	"github.com/autom8ter/engine/config"
	"github.com/autom8ter/engine/testing/helloworld"
	"testing"
)

func TestNewEngine(t *testing.T) {
	if err := engine.New(helloworld.NewBasicGreeter()).With(config.WithDefaultLogger()).Serve(); err != nil {
		t.Fatal(err.Error())
	}
}
```

# ProtoCtl

Download: go get github.com/autom8ter/engine/protoctl

Usage:
  protoctl [command]

Available Commands:
  build       build and submit docker image to gcp
  endpoints   submit protobuf descriptor to gcp cloud endpoints
  gen         run dockerized prototool generate in current directory
  help        Help about any command
  out         run dockerized protoc to generate protobuf descriptor file
  ping        ping a grpc server with dockerized grpc cli

Flags:
  -h, --help   help for protoctl

Additional help topics:
  protoctl config    

Use "protoctl [command] --help" for more information about a command.

## Example
